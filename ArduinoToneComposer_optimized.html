<!DOCTYPE html>
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<title>Arduino tone() composer</title>
</head>
<body>
<h1>Arduino tone() composer</h1>
    <p>This is a small javascript based webapp by <a href="https://baut.club/">Baut</a> to compose melodies with a graphical user interface.
    You can find the repository with the code [here]. You can also download it locally as a .html file from the repo,
    to allow for easy modification of code and to use the webapp locally/offline.
    </p>
    <p>It needs JavaScript to run, so while most of the site has optional JavaScript, this webapp does not.
      If you want to use it and have JavaScript disabled with extensions or similar, please turn it on again.</p>
    <p>The webapp might struggle/misbehave with mobile devices or any devices that have weird aspect ratios.</p>
    <p>The webapp seems to react sluggishly/slowly for Firefox on Linux (but not on windows), it's safe to assume it will react slow on some other configurations as well. If you know of an easy way to make it run faster, feel free to contact me. Until then, I recommend Firefox on windows or ungoogled chromium on Linux.</p>
    <hr>
    <br>
  <table style="width:100%">
  <tr>
    <td>Volume:<input type="range" min="1" max="100" value="50" id="volsliderinp" onchange="updateSettingsFromInput()"></td>
    <td>Note duration[ms]:<input id="notedurinp" onchange="updateSettingsFromInput()" style="color: #bbbbbb; background:#222222"></td>
    <td>Amount of notes:<input id="repsinp" onchange="updateSettingsFromInput()" style="color: #bbbbbb; background:#222222"></td>
  </tr>
  <tr>
  </table>
  <br style="line-height: 20px;">
  <table style="width:100%">
    <tr>
  <td><button type="button" id="resetbt" style="color: #bbbbbb; background:#222222;">RESET</button></td>
  <td><button type="button" id="expbt" style="color: #bbbbbb; background:#222222">ExportSong</button></td>
  <td><button type="button" id="impbt" style="color: #bbbbbb; background:#222222">ImportSong</button></td>
  <td><button type="button" id="expcbt" style="color: #bbbbbb; background:#222222">Export Code</button></td>
  <td><button type="button" id="playbt" style="color: #bbbbbb; background:#222222">Play Audio</button></td>
  <td><label><input type="checkbox" id="loopbool" style="color: #bbbbbb; background:#222222">LOOP</label></td>
  <td><label><input type="checkbox" id="combinebool" style="color: #bbbbbb; background:#222222">Combine tones</label></td>
  </tr>
</table><br>
<div class="wrapper" id="toolwrapper" style="overflow-x: auto;overflow-y: hidden;width: 100%; height:820px;">
<canvas id="toneoverlay" width="32" height="800" style="border:1px solid #000000;position:absolute;float: left;">
It seems like your browser does not support the HTML canvas tag. Sorry.
</canvas>
<canvas id="tonecompcanv" width="1600" height="800" style="border:1px solid #000000;">
It seems like your browser does not support the HTML canvas tag. Sorry.
</canvas>
</div>

<script>
function e(){this.m=!1;this.j=null;this.v=void 0;this.i=1;this.u=this.A=0;this.l=null}function f(a){if(a.m)throw new TypeError("Generator is already running");a.m=!0}e.prototype.o=function(a){this.v=a};e.prototype.s=function(a){this.l={B:a,C:!0};this.i=this.A||this.u};e.prototype["return"]=function(a){this.l={"return":a};this.i=this.u};function h(a,b,c){a.i=c;return{value:b}}function k(a){this.g=new e;this.F=a}
k.prototype.o=function(a){f(this.g);if(this.g.j)return l(this,this.g.j.next,a,this.g.o);this.g.o(a);return n(this)};function p(a,b){f(a.g);var c=a.g.j;if(c)return l(a,"return"in c?c["return"]:function(d){return{value:d,done:!0}},b,a.g["return"]);a.g["return"](b);return n(a)}k.prototype.s=function(a){f(this.g);if(this.g.j)return l(this,this.g.j["throw"],a,this.g.o);this.g.s(a);return n(this)};
function l(a,b,c,d){try{var g=b.call(a.g.j,c);if(!(g instanceof Object))throw new TypeError("Iterator result "+g+" is not an object");if(!g.done)return a.g.m=!1,g;var m=g.value}catch(w){return a.g.j=null,a.g.s(w),n(a)}a.g.j=null;d.call(a.g,m);return n(a)}function n(a){for(;a.g.i;)try{var b=a.F(a.g);if(b)return a.g.m=!1,{value:b.value,done:!1}}catch(c){a.g.v=void 0,a.g.s(c)}a.g.m=!1;if(a.g.l){b=a.g.l;a.g.l=null;if(b.C)throw b.B;return{value:b["return"],done:!0}}return{value:void 0,done:!0}}
function q(a){this.next=function(b){return a.o(b)};this["throw"]=function(b){return a.s(b)};this["return"]=function(b){return p(a,b)};this[Symbol.iterator]=function(){return this}}function r(a){function b(d){return a.next(d)}function c(d){return a["throw"](d)}new Promise(function(d,g){function m(w){w.done?d(w.value):Promise.resolve(w.value).then(b,c).then(m,g)}m(a.next())})}var t=80;t++;
var u=32*(t+1),v=document.getElementById("loopbool"),x=document.getElementById("tonecompcanv"),y=document.getElementById("toneoverlay"),z=document.getElementById("volsliderinp"),A=document.getElementById("repsinp"),B=document.getElementById("notedurinp"),C=document.getElementById("combinebool"),aa=document.getElementById("resetbt"),ba=document.getElementById("expbt"),ca=document.getElementById("impbt"),da=document.getElementById("expcbt"),ea=document.getElementById("playbt"),fa=x.offsetLeft+x.clientLeft,
ha=x.offsetTop+x.clientTop,E=[130.81,138.59,146.83,155.56,164.81,174.61,185,196,207.65,220,233.08,246.94,261.63,277.18,293.66,311.13,329.63,349.23,369.99,392,415.3,440,466.16,493.88,523.25,554.37,587.33,622.25,659.25,698.46,739.99,783.99,830.61,880,932.33,987.77],ia="C C# D D# E F F# G G# A A# B".split(" "),F=.5,G=x.getContext("2d"),H=y.getContext("2d"),I=[],J=!1,K=200;C.checked=J;v.checked=!1;B.value=K.toString();A.value=(t-1).toString();G.canvas.width=u;L();M();var N=0;H.fillStyle="#bbbbbb";
H.fillRect(0,0,y.width,y.height);H.font="20px Arial";H.fillStyle="#222222";H.strokeStyle="#222222";H.lineWidth=2;for(var O=0;3>=O;O++){for(var P=0;11>=P;P++)H.beginPath(),H.moveTo(0,N+800*P/36),H.lineTo(u,N+800*P/36),H.stroke(),H.fillText(ia[11-P],3,N+800*(P+1)/36-5);N=800/3*O}H.moveTo(32,0);H.lineTo(32,800);H.stroke();
function ja(a){if(isNaN(a))b=new AudioContext,c=b.createOscillator(),c.frequency.value=0;else{var b=new AudioContext,c=b.createOscillator();c.frequency.value=E[a-1];c.type="square";vol=b.createGain();vol.gain.value=F;c.connect(vol).connect(b.destination)}c.start();return c}function Q(a){R(S(a.slice(0,a.length)))}
function R(a){var b,c,d;r(new q(new k(function(g){if(1==g.i){if(0==a.length){g.i=0;return}b=1;c=a[0];if(1<a.length&&(J||0==c))for(;a[1]==c;)b++,a.shift();return 0!=a[0]?(d=ja(a[0]),h(g,new Promise(function(m){return setTimeout(m,K*b)}),6)):h(g,new Promise(function(m){return setTimeout(m,K*b)}),4)}4!=g.i&&d.stop();1!=a.length?(a.shift(),R(a)):1==v.checked&&Q(S(I));g.i=0})))}
x.addEventListener("click",function(a){var b=document.getElementById("toolwrapper"),c=Math.floor((a.pageX-fa+1+b.scrollLeft)/(u/(t+1)));a=36-Math.floor((a.pageY-ha+1+b.scrollTop)/(800/36));if(0!=c){b=c-1;c=b-I.length;if(I.length<=b){for(b=0;b<c;b++)I.push(0);I.push(a)}else I[b]=I[b]==a?0:a;M()}});C.addEventListener("click",function(){J=C.checked});aa.addEventListener("click",function(){I=[];M()});
ba.addEventListener("click",function(){var a=S(I),b=v.checked?1:0,c=C.checked?1:0,d=0;I.length<t&&(d=I.length);a="-"+d.toString()+","+K.toString()+","+b.toString()+","+c.toString()+"+"+a.toString()+"-";a=a.replace(",NaN","");prompt("Copy the following string for saving/sharing:",a)});
ca.addEventListener("click",function(){var a=prompt("Please enter your exported data:","");if(""==a)I=[],M();else if(null!=a&&"-"==a[0]&&"-"==a[a.length-1]){a=a.substr(1,a.length-2);var b=a.split("+")[0].split(",");a=a.split("+")[1].split(",");if(a.length>b[1])alert("The data is not formatted correctly. Sorry.");else{"1"==b[2]?v.checked=!0:"0"==b[2]&&(v.checked=!1);"1"==b[3]?J=C.checked=!0:"0"==b[3]&&(J=C.checked=!1);t=Number(b[0]);K=Number(b[1]);b=a.length;for(var c=0;c<=b;c++)a[c]=Number(a[c]),
(36<a[c]||0>a[c])&&alert("The data is not formatted correctly. Sorry.");I=a;M()}}});da.addEventListener("click",function(){for(var a=I.slice(),b="";0!=a.length;){var c=1,d=a[0];if(1<a.length&&(J||0==d))for(;a[1]==d;)c++,a.shift();c*=K;b=0==d?b+("  delay("+c.toString()+");\n"):b+("  tone(buzzerpin,"+Math.round(E[d]).toString()+","+c.toString()+");\n");a.shift()}alert("void playTune(){\n  int buzzerpin=0;\n"+b+"}")});ea.addEventListener("click",function(){Q(I)});
volsliderinp.addEventListener("click",function(){L()});notedurinp.addEventListener("click",function(){L()});repsinp.addEventListener("click",function(){L()});
function M(){x.width=32*(t+1);u=32*(t+1);G.clearRect(0,0,x.width,x.height);G.fillStyle="#222222";G.fillRect(0,0,x.width,x.height);var a=x.width,b=t+1,c=I;G.fillStyle="#bbbbbb";for(var d=0;d<=c.length;d++)G.beginPath(),G.fillRect((d+1)*a/b,800/36*(35-(c[d]-1)),a/b,800/36),G.stroke();a=x.width;c=t+1;b=0;G.font="20px Arial";G.fillStyle="#bbbbbb";G.beginPath();G.strokeStyle="#bbbbbb";for(d=0;d<=c;d++)1==d?(G.lineWidth=4,G.moveTo(a/c*d,0),G.lineTo(a/c*d,800),G.stroke(),G.lineWidth=2):(G.moveTo(a/c*d,0),
G.lineTo(a/c*d,800),G.stroke());for(c=0;3>=c;c++){G.strokeStyle="#bbbbbb";for(d=0;11>=d;d++)G.beginPath(),0!=d&&(G.moveTo(0,b+800*d/36),G.lineTo(a,b+800*d/36),G.stroke()),G.closePath();3!=c&&(G.beginPath(),G.lineWidth=4,G.moveTo(0,b+9600/36),G.lineTo(a,b+9600/36),G.stroke(),G.lineWidth=2,G.closePath());b=800/3*c}}function S(a){for(;0==a[a.length-1];)a.pop();return a}
function L(){F=Number(z.value)/100;isNaN(A.value)||isNaN(parseFloat(A.value))||(t=parseInt(A.value),M());isNaN(B.value)||isNaN(parseFloat(B.value))||(K=parseInt(B.value))}</script>
</body>
</html>
